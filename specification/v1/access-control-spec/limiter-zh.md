# 访问限流

[English](./limiter.md) | 简体中文

---

## 定义

限流能力是高并发系统中，对于服务提供方的一种保护手段。通过限流功能，我们可以通过控制QPS的方式，以避免被瞬时的流量高峰冲垮，从而保障系统的高可用性。

访问限流主要有如下两个应用场景：

- 过载保护：保护业务不被突发流量打垮

- 业务防刷：防止恶意用户发送过多流量影响其他正常用户

访问限流一般有单机限流和分布式限流两种实现方式：

### 单机限流

针对单个被调实例的级别的限流，流量限额只针对当前被调实例生效，不共享。一般适用于保护服务自身不被打垮，按照每个服务集群单机的容量来计算配额。

![](https://polarismesh.cn/assets/img/single_arch.5259c177.png)

### 全局限流

针对服务下所有实例级别的限流，多个服务实例共享同一个全局流量限额。一般适用于保护第三方服务或者公共服务（比如保护数据库）；或者是在网关层进行限流，对通过网关接入的后端服务进行保护。

![](https://polarismesh.cn/assets/img/share_arch.79663f9c.png)

## 属性

- RateLimit

| 名称      | 类型        | 描述                                         | 是否必选 |
| --------- | ----------- | -------------------------------------------- | -------- |
| namespace | string      | 规则所属的命名空间                           | 是       |
| service   | string      | 规则所属的服务                               | 是       |
| resource  | enum        | 限流资源类型，QPS or Concurrency             | 是       |
| type      | enum        | 限流类型，单机 or 全局                       | 是       |
| method    | MatchString | 匹配请求来源的接口                           | 否       |
| labels    | map         | 匹配请求的标签，匹配上才使用该规则           | 否       |
| amounts   | Amount[]    | 限流的配额信息                               | 是       |
| action    | string      | 流量被限制后的行为策略，直接拒绝还是匀速排队 | 是       |
| disable   | bool        | 是否禁用该规则                               | 否       |

- Amount

| 名称          | 类型   | 描述             | 是否必选 |
| ------------- | ------ | ---------------- | -------- |
| maxAmount     | uint32 | 最大配额数       | 是       |
| validDuration | uint32 | 配额生效的时间段 | 是       |

